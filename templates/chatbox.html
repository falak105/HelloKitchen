{% load static %}
{% block content %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{% static 'css/chatbox.css' %}">
    <title>Chatbox with Voice Assistant</title>
</head>
<body>
    <div class="chatbox-container">
        <div class="chatbox-header">
            <h2>Smart Assistant</h2>
        </div>
        <div class="chatbox-body" id="chatbox-body">
            <div class="chat-message bot-message">
                <p>Hello! How can I assist you today?</p>
            </div>
        </div>
        <div class="chatbox-footer">
            <input type="text" id="chat-input" placeholder="Type your message..." />
            <button id="send-btn" class="send-btn">Send</button>
            <button id="voice-btn" class="voice-btn">
                <i class="mic-icon"></i> <!-- Placeholder for mic icon -->
            </button>
        </div>
    </div>

    <script>

        // Add your JavaScript functionality here for voice recognition and sending messages
        import { createReadStream, writeFile } from 'fs';
        import { createInterface } from 'readline';
        import { exec } from 'child_process';
        import { AudioContext } from 'web-audio-api';

        // Simplified audio recording and storage function
        async function recordAudio(filename) {
        return new Promise((resolve, reject) => {
            // Record audio and save it as the specified file
            exec(`arecord -f S16_LE -r 16000 -d 5 ${filename}`, (error) => {
            if (error) {
                console.error(`Recording error: ${error}`);
                reject(error);
            } else {
                console.log(`Audio recorded and saved to ${filename}`);
                resolve(createReadStream(filename));
            }
            });
        });
        }

        async function main() {
        const rl = createInterface({
            input: process.stdin,
            output: process.stdout,
        });

        while (true) {
            console.log("Say 'kitchen' to start recording your question...");
            await recordAudio('input.wav'); // Record initial keyword trigger audio

            // Process the audio file to get the transcription (This function needs to be defined)
            const transcription = await transcribeAudioToText('input.wav');
            if (transcription.toLowerCase() === 'hey kitchen') {
            console.log('Say your question...');
            await recordAudio('question.wav'); // Record the question audio

            // Transcribe and handle the question audio
            const questionText = await transcribeAudioToText('question.wav');
            if (questionText) {
                console.log(`You said: ${questionText}`);

                // Generate a response using GPT-3 (This function needs to be defined)
                const response = await generateResponse(questionText);
                console.log(`GPT-3 says: ${response}`);

                // Read the response using text-to-speech (This function needs to be defined)
                speakText(response);
            }
            }
        }
        }

        // Ensure the main function handles errors gracefully
        main().catch((err) => console.error('An Error occurred:', err));

    </script>
</body>
</html>
{% endblock content %}